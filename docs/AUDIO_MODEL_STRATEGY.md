# è¯­éŸ³æ¨¡å‹è°ƒåº¦ç­–ç•¥ - AiTutor å†å²å­¦ä¹ åŠ©æ‰‹

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0
> **æ›´æ–°æ—¥æœŸ**: 2026-01-05
> **é€‚ç”¨æ¨¡å‹**: step-audio-2, step-audio-2-mini

---

## ğŸ“Š æ¨¡å‹å¯¹æ¯”åˆ†æ

| ç‰¹æ€§ | step-audio-2 | step-audio-2-mini | å·®å¼‚è¯´æ˜ |
|------|-------------|-------------------|---------|
| **è¯­è¨€æ”¯æŒ** | ä¸­æ–‡(æ™®é€šè¯+æ–¹è¨€)ã€è‹±è¯­ã€æ—¥è¯­ | ç›¸åŒ | æ— å·®å¼‚ |
| **è¾“å‡ºè¯­è¨€** | ä¸­æ–‡ã€è‹±è¯­ | ç›¸åŒ | æ— å·®å¼‚ |
| **ç¯å¢ƒå£°éŸ³ç†è§£** | âœ… | âœ… | æ— å·®å¼‚ |
| **æƒ…ç»ªè¯†åˆ«** | âœ… | âœ… | æ— å·®å¼‚ |
| **å¹´é¾„æ¨æµ‹** | âœ… | âœ… | æ— å·®å¼‚ |
| **éŸ³ä¹ç†è§£** | âœ… | âœ… | æ— å·®å¼‚ |
| **è¯­é€Ÿ/è¯­è°ƒ/æƒ…æ„Ÿæ§åˆ¶** | âœ… | âœ… | æ— å·®å¼‚ |
| **Tool Call** | âœ… åŸç”Ÿæ”¯æŒ | âœ… åŸç”Ÿæ”¯æŒ | æ— å·®å¼‚ |
| **ç½‘ç»œæœç´¢** | âœ… | âœ… | æ— å·®å¼‚ |
| **æŒ‡ä»¤éµå¾ª** | â­â­â­â­â­ | â­â­â­â­ | mini ç•¥ä½ |
| **æ•°ç†æ¨ç†** | â­â­â­â­â­ | â­â­â­â­ | mini ç•¥ä½ |
| **æ¨ç†é€Ÿåº¦** | æ ‡å‡† | **æ›´å¿«** | mini ä¼˜åŠ¿ |
| **èµ„æºæ¶ˆè€—** | è¾ƒé«˜ | **æ›´ä½** | mini ä¼˜åŠ¿ |
| **æˆæœ¬** | è¾ƒé«˜ | **è¾ƒä½** | mini ä¼˜åŠ¿ |

---

## ğŸ¯ æ™ºèƒ½è°ƒåº¦ç­–ç•¥

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**: ä¿è¯å“åº”é€Ÿåº¦å’Œå¯¹è¯è´¨é‡
2. **æˆæœ¬æ•ˆç›Šå¹³è¡¡**: å¤æ‚ä»»åŠ¡ç”¨ step-audio-2ï¼Œç®€å•ä»»åŠ¡ç”¨ mini
3. **åŠ¨æ€é™çº§**: ç½‘ç»œå·®æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ° mini
4. **ç”¨æˆ·å¯é…ç½®**: å…è®¸é«˜çº§ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹©

---

## ğŸ“‹ åœºæ™¯æ˜ å°„è¡¨

### **ä¼˜å…ˆä½¿ç”¨ step-audio-2 çš„åœºæ™¯** â­â­â­â­â­

#### 1. å¤æ‚å†å²æ¨ç†åœºæ™¯
```
åœºæ™¯ç‰¹å¾:
- æ¶‰åŠå¤šç»´åº¦åˆ†æï¼ˆæ”¿æ²»/ç»æµ/æ–‡åŒ–ï¼‰
- éœ€è¦æ·±åº¦æ¨ç†ï¼ˆ"å¦‚æœ"å†å²ï¼‰
- å¤šè½®å¯¹è¯çš„å¤æ‚é—®é¢˜

ç¤ºä¾‹å¯¹è¯:
âŒ mini: "ç§¦å§‹çš‡ç»Ÿä¸€å…­å›½çš„å½±å“æ˜¯ä»€ä¹ˆï¼Ÿ"
âœ… step-audio-2: "å¦‚æœç§¦å§‹çš‡æ²¡æœ‰ç»Ÿä¸€å…­å›½ï¼Œä¸­å›½ä¼šæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿ
                è¯·ä»æ”¿æ²»æ ¼å±€ã€æ–‡åŒ–å‘å±•ã€æ°‘æ—å½¢æˆä¸‰ä¸ªè§’åº¦åˆ†æ"

è§¦å‘æ¡ä»¶:
- é—®é¢˜åŒ…å«"å¦‚æœ""å‡è®¾""æ¯”è¾ƒ""åˆ†æ"ç­‰å…³é”®è¯
- é—®é¢˜é•¿åº¦ > 30å­—
- å¯¹è¯è½®æ¬¡ > 5è½®ï¼ˆè¿›å…¥æ·±åº¦æ¢è®¨ï¼‰
```

#### 2. æ•°å­¦/é€»è¾‘æ¨ç†åœºæ™¯
```
åœºæ™¯ç‰¹å¾:
- å†å²å¹´ä»£è®¡ç®—ï¼ˆ"ç§¦æœåˆ°å”æœå·®å¤šå°‘å¹´ï¼Ÿ"ï¼‰
- ç»Ÿè®¡åˆ†æï¼ˆ"å”æœçš‡å¸å¹³å‡åœ¨ä½å¤šå°‘å¹´ï¼Ÿ"ï¼‰
- é€»è¾‘æ¨ç†ï¼ˆ"ä¸ºä»€ä¹ˆä¸‰å›½é¼ç«‹è€Œä¸æ˜¯å››å›½ï¼Ÿ"ï¼‰

ç¤ºä¾‹å¯¹è¯:
âŒ mini: "èµ¤å£ä¹‹æˆ˜æ›¹æ“æœ‰å¤šå°‘ä¸‡å†›é˜Ÿï¼Ÿ"ï¼ˆç®€å•äº‹å®ï¼‰
âœ… step-audio-2: "ä¸ºä»€ä¹ˆå·ç§°80ä¸‡çš„æ›¹æ“å†›é˜Ÿä¼šè´¥ç»™5ä¸‡å­™åˆ˜è”å†›ï¼Ÿ
                ä»å…µåŠ›çš„æ•°é‡ä¸è´¨é‡ã€åœ°å½¢ã€æˆ˜æœ¯ä¸‰ä¸ªè§’åº¦æ¨ç†"

è§¦å‘æ¡ä»¶:
- åŒ…å«æ•°å­—è®¡ç®—é—®é¢˜
- åŒ…å«"ä¸ºä»€ä¹ˆ""æ€æ ·""å¦‚ä½•"ç­‰æ¨ç†è¯
- éœ€è¦è·¨çŸ¥è¯†ç‚¹å…³è”
```

#### 3. ç²¾ç¡®æŒ‡ä»¤éµå¾ªåœºæ™¯
```
åœºæ™¯ç‰¹å¾:
- ç”¨æˆ·æå‡ºå¤æ‚æ ¼å¼è¦æ±‚ï¼ˆ"ç”¨è¡¨æ ¼å¯¹æ¯”""åˆ—å‡º3ä¸ªåŸå› "ï¼‰
- è§’è‰²æ‰®æ¼”è¦æ±‚ï¼ˆ"ä½ æ˜¯ä¸€ä¸ªè¯´ä¹¦äºº""ç”¨ä¾¦æ¢çš„å£å»"ï¼‰
- ç‰¹æ®Šè¾“å‡ºè¦æ±‚ï¼ˆ"ç”¨è¯—è¯è¡¨è¾¾""ä¸è¶…è¿‡50å­—"ï¼‰

ç¤ºä¾‹å¯¹è¯:
âŒ mini: "ä»‹ç»ä¸€ä¸‹å”æœ"
âœ… step-audio-2: "ä½ æ˜¯ä¸€ä¸ªè¯´ä¹¦äººï¼Œç”¨è¯„ä¹¦çš„é£æ ¼ç”ŸåŠ¨åœ°è®²è¿°ç„æ­¦é—¨ä¹‹å˜ï¼Œ
                è¦æ±‚ï¼š1. åˆ¶é€ æ‚¬å¿µ 2. æƒ…æ„Ÿé¥±æ»¡ 3. 200å­—å·¦å³"

è§¦å‘æ¡ä»¶:
- åŒ…å«"ä½ æ˜¯ä¸€ä¸ª""è¯·ç”¨""è¦æ±‚"ç­‰è§’è‰²/æ ¼å¼æŒ‡ä»¤
- åŒ…å«æ˜ç¡®æ ¼å¼è¦æ±‚ï¼ˆè¡¨æ ¼ã€åˆ—è¡¨ã€è¯—è¯ï¼‰
- åŒ…å«é•¿åº¦/é£æ ¼é™åˆ¶
```

#### 4. Tool Call + ç½‘ç»œæœç´¢åœºæ™¯
```
åœºæ™¯ç‰¹å¾:
- éœ€è¦è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼ˆç”Ÿå›¾ã€Vision APIï¼‰
- éœ€è¦æœç´¢æœ€æ–°å†å²ç ”ç©¶
- éœ€è¦æŸ¥è¯¢å®æ—¶ä¿¡æ¯

ç¤ºä¾‹å¯¹è¯:
âŒ mini: "ç§¦å§‹çš‡æ˜¯ä»€ä¹ˆæ—¶å€™ç»Ÿä¸€å…­å›½çš„ï¼Ÿ"
âœ… step-audio-2: "å¸®æˆ‘æŸ¥ä¸€ä¸‹æœ€è¿‘è€ƒå¤å‘ç°å…³äºå…µé©¬ä¿‘çš„æ–°ç ”ç©¶ï¼Œ
                å¹¶ç”¨ Vision API åˆ†æè¿™å¼ å…µé©¬ä¿‘ç…§ç‰‡"

è§¦å‘æ¡ä»¶:
- æ˜ç¡®è¦æ±‚"æœç´¢""æŸ¥ä¸€ä¸‹""æœ€æ–°ç ”ç©¶"
- éœ€è¦è°ƒç”¨å…¶ä»– APIï¼ˆç”Ÿæˆå›¾ç‰‡ã€åˆ†æå›¾ç‰‡ï¼‰
- æ¶‰åŠæœ€æ–°å‘ç°çš„è€ƒå¤/å†å²äº‹ä»¶
```

---

### **ä¼˜å…ˆä½¿ç”¨ step-audio-2-mini çš„åœºæ™¯** â­â­â­â­â­

#### 1. ç®€å•äº‹å®æŸ¥è¯¢åœºæ™¯
```
åœºæ™¯ç‰¹å¾:
- å•ä¸€çŸ¥è¯†ç‚¹é—®ç­”ï¼ˆ"ç§¦å§‹çš‡æ˜¯è°ï¼Ÿ"ï¼‰
- æ—¶é—´/åœ°ç‚¹/äººç‰©æŸ¥è¯¢ï¼ˆ"å”æœä»€ä¹ˆæ—¶å€™å»ºç«‹çš„ï¼Ÿ"ï¼‰
- å®šä¹‰/æ¦‚å¿µè§£é‡Šï¼ˆ"ä»€ä¹ˆæ˜¯ç§‘ä¸¾åˆ¶ï¼Ÿ"ï¼‰

ç¤ºä¾‹å¯¹è¯:
âœ… mini: "ç§¦å§‹çš‡æ˜¯ä»€ä¹ˆæ—¶å€™ç»Ÿä¸€å…­å›½çš„ï¼Ÿ"
âœ… mini: "å”æœçš„é¦–éƒ½åœ¨å“ªé‡Œï¼Ÿ"
âœ… mini: "ç§‘ä¸¾åˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ"

è§¦å‘æ¡ä»¶:
- é—®é¢˜é•¿åº¦ < 20å­—
- å•ä¸€äº‹å®æ€§ç­”æ¡ˆ
- ä¸éœ€è¦æ¨ç†æˆ–åˆ†æ
```

#### 2. å¿«é€Ÿå¯¹è¯å¼€åœºåœºæ™¯
```
åœºæ™¯ç‰¹å¾:
- é¦–æ¬¡é—®å€™/è‡ªæˆ‘ä»‹ç»
- ç®€å•äº’åŠ¨ï¼ˆ"ä½ å¥½""æˆ‘æ˜¯è°""ä»Šå¤©å­¦äº†ä»€ä¹ˆ"ï¼‰
- çŠ¶æ€æŸ¥è¯¢ï¼ˆ"æˆ‘ä»¬åˆšæ‰è®²åˆ°å“ªäº†ï¼Ÿ"ï¼‰

ç¤ºä¾‹å¯¹è¯:
âœ… mini: "ä½ å¥½"
âœ… mini: "ä»Šå¤©æˆ‘ä»¬å­¦äº†ä»€ä¹ˆï¼Ÿ"
ï¿½ï¸ mini: "ç»§ç»­è®²åˆšæ‰çš„æ•…äº‹"

è§¦å‘æ¡ä»¶:
- å¯¹è¯è½®æ¬¡ < 3è½®
- ç®€å•é—®å€™/ç¡®è®¤ç±»é—®é¢˜
- æ— éœ€æ·±åº¦æ€è€ƒ
```

#### 3. ä½ç½‘ç»œè´¨é‡åœºæ™¯
```
åœºæ™¯ç‰¹å¾:
- æ£€æµ‹åˆ°ç½‘ç»œå»¶è¿Ÿ > 2ç§’
- æ£€æµ‹åˆ°ä¸¢åŒ…ç‡ > 10%
- ç”¨æˆ·åé¦ˆ"å“åº”æ…¢"

è‡ªåŠ¨åˆ‡æ¢é€»è¾‘:
```
if (networkLatency > 2000ms || packetLoss > 10%) {
  model = "step-audio-2-mini";  // è‡ªåŠ¨é™çº§
  showNotification("ç½‘ç»œè¾ƒæ…¢ï¼Œå·²åˆ‡æ¢åˆ°å¿«é€Ÿæ¨¡å¼");
}
```
```

#### 4. ç§»åŠ¨ç«¯/ä½æ€§èƒ½è®¾å¤‡åœºæ™¯
```
åœºæ™¯ç‰¹å¾:
- æ£€æµ‹åˆ°ç§»åŠ¨ç«¯è®¾å¤‡
- æ£€æµ‹åˆ°ä½æ€§èƒ½è®¾å¤‡ï¼ˆé€šè¿‡ UserAgent æˆ–æ€§èƒ½æµ‹è¯•ï¼‰
- ç”¨æˆ·å¯ç”¨"çœæµé‡æ¨¡å¼"

è‡ªåŠ¨åˆ‡æ¢é€»è¾‘:
```
if (isMobile || isLowPerformance || userPreference.dataSaver) {
  model = "step-audio-2-mini";
}
```
```

---

## ğŸ”„ åŠ¨æ€è°ƒåº¦ç®—æ³•

### ç®—æ³•æµç¨‹å›¾

```
ç”¨æˆ·å‘é€è¯­éŸ³/æ–‡æœ¬
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœºæ™¯åˆ†æå™¨      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¡ç®—å¤æ‚åº¦åˆ†æ•° (0-100)                â”‚
â”‚ - é—®é¢˜é•¿åº¦: +1åˆ†/å­—                   â”‚
â”‚ - å…³é”®è¯: "å¦‚æœ"+30, "ä¸ºä»€ä¹ˆ"+20      â”‚
â”‚ - å¯¹è¯è½®æ¬¡: +5åˆ†/è½®                   â”‚
â”‚ - æ˜¯å¦éœ€è¦å·¥å…·è°ƒç”¨: +40åˆ†             â”‚
â”‚ - æ˜¯å¦éœ€è¦ç½‘ç»œæœç´¢: +30åˆ†             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¯å¢ƒå› ç´ æ£€æµ‹                          â”‚
â”‚ - ç½‘ç»œå»¶è¿Ÿ: >2s åˆ™ -30åˆ†              â”‚
â”‚ - è®¾å¤‡æ€§èƒ½: ä½æ€§èƒ½åˆ™ -20åˆ†            â”‚
â”‚ - ç”¨æˆ·åå¥½: èŠ‚æµæ¨¡å¼åˆ™ -40åˆ†          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœ€ç»ˆå†³ç­–                              â”‚
â”‚ åˆ†æ•° >= 50 â†’ step-audio-2             â”‚
â”‚ åˆ†æ•° < 50 â†’ step-audio-2-mini         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»£ç å®ç°

```typescript
// web/lib/model-selector.ts

export interface ModelSelectionContext {
  userQuery: string;
  conversationTurns: number;
  networkLatency: number;
  devicePerformance: 'high' | 'medium' | 'low';
  userPreferences: {
    dataSaver: boolean;
    preferredModel?: 'step-audio-2' | 'step-audio-2-mini';
  };
}

export class AudioModelSelector {
  private readonly COMPLEXITY_THRESHOLD = 50;

  selectModel(context: ModelSelectionContext): 'step-audio-2' | 'step-audio-2-mini' {
    // 1. ç”¨æˆ·æ˜ç¡®æŒ‡å®š
    if (context.userPreferences.preferredModel) {
      return context.userPreferences.preferredModel;
    }

    // 2. è®¡ç®—å¤æ‚åº¦åˆ†æ•°
    let complexityScore = this.calculateComplexity(context);

    // 3. åº”ç”¨ç¯å¢ƒå› ç´ æƒ©ç½š
    complexityScore = this.applyEnvironmentPenalty(
      complexityScore,
      context.networkLatency,
      context.devicePerformance,
      context.userPreferences.dataSaver
    );

    // 4. æœ€ç»ˆå†³ç­–
    return complexityScore >= this.COMPLEXITY_THRESHOLD
      ? 'step-audio-2'
      : 'step-audio-2-mini';
  }

  private calculateComplexity(context: ModelSelectionContext): number {
    let score = 0;

    // é—®é¢˜é•¿åº¦ (æ¯å­—+1åˆ†ï¼Œæœ€é«˜20åˆ†)
    score += Math.min(context.userQuery.length * 1, 20);

    // å…³é”®è¯æ£€æµ‹
    const complexKeywords = {
      'å¦‚æœ': 30,
      'å‡è®¾': 30,
      'ä¸ºä»€ä¹ˆ': 20,
      'å¦‚ä½•': 20,
      'æ€æ ·': 20,
      'æ¯”è¾ƒ': 25,
      'åˆ†æ': 25,
      'æ¨ç†': 30,
      'è®¡ç®—': 15,
    };

    for (const [keyword, points] of Object.entries(complexKeywords)) {
      if (context.userQuery.includes(keyword)) {
        score += points;
      }
    }

    // å¯¹è¯è½®æ¬¡ (æ¯è½®+5åˆ†ï¼Œæœ€é«˜30åˆ†)
    score += Math.min(context.conversationTurns * 5, 30);

    // ç‰¹æ®Šéœ€æ±‚æ£€æµ‹
    if (context.userQuery.includes('æœç´¢') || context.userQuery.includes('æŸ¥')) {
      score += 30; // éœ€è¦ç½‘ç»œæœç´¢
    }

    if (context.userQuery.includes('ç”Ÿæˆå›¾ç‰‡') || context.userQuery.includes('çœ‹å›¾')) {
      score += 40; // éœ€è¦ Tool Call
    }

    return score;
  }

  private applyEnvironmentPenalty(
    score: number,
    networkLatency: number,
    devicePerformance: string,
    dataSaver: boolean
  ): number {
    let adjustedScore = score;

    // ç½‘ç»œå»¶è¿Ÿæƒ©ç½š
    if (networkLatency > 2000) {
      adjustedScore -= 30;
    }

    // è®¾å¤‡æ€§èƒ½æƒ©ç½š
    if (devicePerformance === 'low') {
      adjustedScore -= 20;
    } else if (devicePerformance === 'medium') {
      adjustedScore -= 10;
    }

    // çœæµé‡æ¨¡å¼æƒ©ç½š
    if (dataSaver) {
      adjustedScore -= 40;
    }

    return Math.max(0, adjustedScore);
  }
}
```

---

## ğŸ’¡ ç”¨æˆ·é…ç½®é€‰é¡¹

### è®¾ç½®ç•Œé¢è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš™ï¸ æ¨¡å‹è®¾ç½®                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  æ¨¡å‹é€‰æ‹©                           â”‚
â”‚  â—‹ è‡ªåŠ¨é€‰æ‹©ï¼ˆæ¨èï¼‰                 â”‚
â”‚     æ ¹æ®é—®é¢˜å¤æ‚åº¦è‡ªåŠ¨åˆ‡æ¢          â”‚
â”‚                                     â”‚
â”‚  â—‹ é«˜è´¨é‡æ¨¡å¼                       â”‚
â”‚     å§‹ç»ˆä½¿ç”¨ step-audio-2           â”‚
â”‚     âš ï¸ å“åº”ç¨æ…¢ï¼Œè´¨é‡æ›´é«˜           â”‚
â”‚                                     â”‚
â”‚  â—‹ å¿«é€Ÿæ¨¡å¼                         â”‚
â”‚     å§‹ç»ˆä½¿ç”¨ step-audio-2-mini      â”‚
â”‚     âœ… å“åº”æ›´å¿«ï¼ŒèŠ‚çœæµé‡           â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  çœæµé‡æ¨¡å¼                         â”‚
â”‚  ğŸ”˜ å·²å¯ç”¨  âšª æœªå¯ç”¨               â”‚
â”‚                                     â”‚
â”‚  ç½‘ç»œè´¨é‡æ£€æµ‹                       â”‚
â”‚  å»¶è¿Ÿ: 1.2s âœ… è‰¯å¥½                 â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»£ç å®ç°

```typescript
// web/components/realtime-voice/ModelSettings.tsx

export function ModelSettings() {
  const [modelMode, setModelMode] = useState<'auto' | 'quality' | 'fast'>('auto');
  const [dataSaver, setDataSaver] = useState(false);
  const [networkLatency, setNetworkLatency] = useState(1200);

  return (
    <div className="model-settings">
      <h3>æ¨¡å‹é€‰æ‹©</h3>

      <label>
        <input
          type="radio"
          name="modelMode"
          checked={modelMode === 'auto'}
          onChange={() => setModelMode('auto')}
        />
        è‡ªåŠ¨é€‰æ‹©ï¼ˆæ¨èï¼‰
        <p className="hint">æ ¹æ®é—®é¢˜å¤æ‚åº¦è‡ªåŠ¨åˆ‡æ¢</p>
      </label>

      <label>
        <input
          type="radio"
          name="modelMode"
          checked={modelMode === 'quality'}
          onChange={() => setModelMode('quality')}
        />
        é«˜è´¨é‡æ¨¡å¼
        <p className="hint">å§‹ç»ˆä½¿ç”¨ step-audio-2ï¼Œå“åº”ç¨æ…¢ä½†è´¨é‡æ›´é«˜</p>
      </label>

      <label>
        <input
          type="radio"
          name="modelMode"
          checked={modelMode === 'fast'}
          onChange={() => setModelMode('fast')}
        />
        å¿«é€Ÿæ¨¡å¼
        <p className="hint">å§‹ç»ˆä½¿ç”¨ step-audio-2-miniï¼Œå“åº”æ›´å¿«</p>
      </label>

      <hr />

      <label className="toggle">
        <input
          type="checkbox"
          checked={dataSaver}
          onChange={(e) => setDataSaver(e.target.checked)}
        />
        çœæµé‡æ¨¡å¼
        <p className="hint">ä¼˜å…ˆä½¿ç”¨ mini æ¨¡å‹èŠ‚çœæµé‡</p>
      </label>

      <div className="network-status">
        <p>ç½‘ç»œè´¨é‡æ£€æµ‹</p>
        <p>å»¶è¿Ÿ: {(networkLatency / 1000).toFixed(1)}s
          {networkLatency < 1500 ? ' âœ… è‰¯å¥½' : ' âš ï¸ è¾ƒæ…¢'}
        </p>
      </div>
    </div>
  );
}
```

---

## ğŸ“ˆ æˆæœ¬ä¼˜åŒ–åˆ†æ

### æˆæœ¬å¯¹æ¯”ï¼ˆæ¯åˆ†é’Ÿï¼‰

| æ¨¡å‹ | æˆæœ¬ | å“åº”é€Ÿåº¦ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|---------|
| step-audio-2 | Â¥0.03 | ~2s | å¤æ‚æ¨ç† |
| step-audio-2-mini | Â¥0.02 | ~1s | ç®€å•å¯¹è¯ |

### æ™ºèƒ½è°ƒåº¦çš„æˆæœ¬èŠ‚çœ

å‡è®¾ç”¨æˆ·å…¸å‹å¯¹è¯æ¨¡å¼ï¼š
- 10% å¤æ‚æ¨ç†ï¼ˆstep-audio-2ï¼‰
- 60% ç®€å•å¯¹è¯ï¼ˆminiï¼‰
- 20% ä¸­ç­‰å¤æ‚åº¦ï¼ˆminiï¼‰
- 10% ä½ç½‘ç»œç¯å¢ƒï¼ˆminiï¼‰

**æˆæœ¬å¯¹æ¯”**:
```
å…¨éƒ¨ä½¿ç”¨ step-audio-2: Â¥0.03/åˆ†é’Ÿ Ã— 100% = Â¥0.030/åˆ†é’Ÿ
æ™ºèƒ½è°ƒåº¦: Â¥0.03Ã—10% + Â¥0.02Ã—90% = Â¥0.021/åˆ†é’Ÿ

èŠ‚çœ: 30% ğŸ’°
```

---

## ğŸ”§ æŠ€æœ¯å®ç°é›†æˆ

### ä¿®æ”¹ç°æœ‰å®¢æˆ·ç«¯

```typescript
// web/lib/stepfun-realtime.ts

export class StepFunRealtimeClient {
  private config: StepFunConfig;
  private modelSelector: AudioModelSelector;

  constructor(config: StepFunConfig) {
    this.config = config;
    this.modelSelector = new AudioModelSelector();
  }

  async connect(
    onStateChange: (state: VoiceState) => void,
    onTextUpdate: (text: string) => void,
    onAudioData: (audioData: string) => Promise<void>
  ) {
    // è·å–å½“å‰ä¸Šä¸‹æ–‡
    const context = this.buildContext();

    // é€‰æ‹©æ¨¡å‹
    const selectedModel = this.modelSelector.selectModel(context);

    console.log(`[Model Selector] Using: ${selectedModel}`);

    // åˆ›å»ºä¼šè¯æ—¶æŒ‡å®šæ¨¡å‹
    const sessionConfig = {
      ...this.config,
      model: selectedModel,  // â† åŠ¨æ€é€‰æ‹©
    };

    // ... åŸæœ‰è¿æ¥é€»è¾‘
  }

  private buildContext(): ModelSelectionContext {
    return {
      userQuery: this.getLastUserMessage(),
      conversationTurns: this.getConversationTurns(),
      networkLatency: this.measureNetworkLatency(),
      devicePerformance: this.detectDevicePerformance(),
      userPreferences: {
        dataSaver: this.config.dataSaver || false,
        preferredModel: this.config.preferredModel,
      },
    };
  }

  private async measureNetworkLatency(): Promise<number> {
    const start = Date.now();
    try {
      await fetch('https://api.stepfun.com/health', {
        method: 'HEAD',
        cache: 'no-cache',
      });
      return Date.now() - start;
    } catch {
      return 9999; // ç½‘ç»œä¸å¯ç”¨
    }
  }

  private detectDevicePerformance(): 'high' | 'medium' | 'low' {
    const ua = navigator.userAgent;
    const memory = (navigator as any).deviceMemory || 4;
    const cores = navigator.hardwareConcurrency || 2;

    // ç§»åŠ¨ç«¯æ£€æµ‹
    if (/mobile|android|iphone/i.test(ua)) {
      return memory >= 6 ? 'medium' : 'low';
    }

    // æ¡Œé¢ç«¯æ£€æµ‹
    if (cores >= 8 && memory >= 8) return 'high';
    if (cores >= 4 && memory >= 4) return 'medium';
    return 'low';
  }
}
```

---

## ğŸ“Š ç›‘æ§ä¸åˆ†æ

### æ•°æ®æ”¶é›†æŒ‡æ ‡

```typescript
// web/lib/model-analytics.ts

export class ModelAnalytics {
  trackModelUsage(data: {
    modelUsed: 'step-audio-2' | 'step-audio-2-mini';
    complexityScore: number;
    responseTime: number;
    userSatisfaction?: 'good' | 'neutral' | 'bad';
    networkLatency: number;
  }) {
    // å‘é€åˆ°åˆ†æå¹³å°
    analytics.track('model_selection', data);
  }

  // ç”¨äºä¼˜åŒ–è°ƒåº¦ç­–ç•¥
  generateReport(): ModelUsageReport {
    return {
      totalConversations: 1000,
      stepAudio2Usage: 0.15,      // 15% ä½¿ç”¨ step-audio-2
      stepAudio2MiniUsage: 0.85,   // 85% ä½¿ç”¨ mini
      averageResponseTime: {
        'step-audio-2': 2.1,
        'step-audio-2-mini': 1.2,
      },
      userSatisfactionRate: {
        'step-audio-2': 0.92,
        'step-audio-2-mini': 0.88,
      },
      costSavings: 0.30,           // èŠ‚çœ 30% æˆæœ¬
    };
  }
}
```

---

## ğŸ“ ä½¿ç”¨æŒ‡å—

### å¼€å‘è€…æŒ‡å—

1. **é»˜è®¤ä½¿ç”¨è‡ªåŠ¨æ¨¡å¼**ï¼šè®©ç®—æ³•è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜æ¨¡å‹
2. **ç›‘æ§å…³é”®æŒ‡æ ‡**ï¼šå“åº”æ—¶é—´ã€ç”¨æˆ·æ»¡æ„åº¦ã€æˆæœ¬
3. **å®šæœŸä¼˜åŒ–é˜ˆå€¼**ï¼šæ ¹æ®å®é™…æ•°æ®è°ƒæ•´ `COMPLEXITY_THRESHOLD`
4. **A/B æµ‹è¯•**ï¼šå¯¹æ¯”ä¸åŒç­–ç•¥çš„ç”¨æˆ·ä½“éªŒ

### ç”¨æˆ·æŒ‡å—ï¼ˆUI æ˜¾ç¤ºï¼‰

```
ğŸ’¡ æç¤ºï¼š

- é«˜è´¨é‡æ¨¡å¼ï¼šé€‚åˆæ·±åº¦å­¦ä¹ å’Œå¤æ‚é—®é¢˜
- å¿«é€Ÿæ¨¡å¼ï¼šé€‚åˆå¿«é€Ÿé—®ç­”å’Œç§»åŠ¨ç«¯ä½¿ç”¨
- è‡ªåŠ¨é€‰æ‹©ï¼šç³»ç»Ÿä¼šæ ¹æ®é—®é¢˜æ™ºèƒ½åˆ‡æ¢

å½“å‰è®¾ç½®ï¼šè‡ªåŠ¨é€‰æ‹© âœ…
```

---

## ğŸ“ ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ |
|------|------|---------|
| v1.0 | 2026-01-05 | åˆå§‹ç‰ˆæœ¬ï¼Œå®šä¹‰è°ƒåº¦ç­–ç•¥ |

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [StepFun å®æ—¶è¯­éŸ³ API æ–‡æ¡£](https://platform.stepfun.com/docs/zh/llm/realtime)
- [HISTORY_ASSISTANT_PLAN.md](../HISTORY_ASSISTANT_PLAN.md)
- [å¼€å‘è®¡åˆ’](../DEV_PLAN.md)
