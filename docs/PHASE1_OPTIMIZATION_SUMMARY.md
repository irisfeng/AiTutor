# AiTutor å‰ç«¯åŠ¨æ€åŒ–ä¼˜åŒ– - é˜¶æ®µ 1 å®Œæˆæ€»ç»“

## ğŸ“… å®Œæˆæ—¶é—´
2026-01-11

---

## âœ… å·²å®Œæˆä»»åŠ¡

### 1. é…ç½®æ–‡ä»¶åŒ–

#### åˆ›å»ºçš„æ–‡ä»¶

**`web/config/subjects.ts`** - å­¦ç§‘é…ç½®
- âœ… æ”¯æŒ 7 ä¸ªå­¦ç§‘ï¼šç”Ÿç‰©å­¦ã€å†å²ã€ç‰©ç†ã€åŒ–å­¦ã€æ•°å­¦ã€æ–‡å­¦ã€åœ°ç†
- âœ… æ¯ä¸ªå­¦ç§‘åŒ…å«ï¼šidã€åç§°ã€å›¾æ ‡ã€é¢œè‰²ã€å…³é”®è¯ã€é»˜è®¤äººè®¾
- âœ… æä¾›è¾…åŠ©å‡½æ•°ï¼š`getSubjectById()`, `suggestSubjectByKeywords()`

**`web/config/models.ts`** - æ¨¡å‹å’ŒéŸ³è‰²é…ç½®
- âœ… 2 ä¸ª AI æ¨¡å‹ï¼šstep-audio-2ï¼ˆæ¨èï¼‰ã€step-audio-2-miniï¼ˆå¿«é€Ÿï¼‰
- âœ… 2 ç§éŸ³è‰²ï¼šé’æ˜¥å°‘å¥³ã€æ¸©æŸ”ç”·å£°
- âœ… æä¾›è¾…åŠ©å‡½æ•°ï¼š`getModelById()`, `getVoiceById()`, `getRecommendedModel()`

**`web/lib/prompts/personas.ts`** - æ›´æ–°
- âœ… æ·»åŠ  `PERSONAS` æ•°ç»„å¯¼å‡ºï¼ˆä¾¿äºåŠ¨æ€æ¸²æŸ“ï¼‰
- âœ… æ·»åŠ  `DEFAULT_PERSONA` å¸¸é‡
- âœ… æ·»åŠ  `getPersonaTypeIds()` è¾…åŠ©å‡½æ•°

---

### 2. å­¦ç§‘é€‰æ‹©åŠŸèƒ½

#### åˆ›å»ºçš„æ–‡ä»¶

**`web/components/SubjectSelector.tsx`** - å­¦ç§‘é€‰æ‹©å™¨ç»„ä»¶
- âœ… ä¸‹æ‹‰èœå•å½¢å¼ï¼Œæ”¯æŒæ‰€æœ‰ 7 ä¸ªå­¦ç§‘
- âœ… æ˜¾ç¤ºå­¦ç§‘å›¾æ ‡å’Œåç§°
- âœ… æ”¯æŒç¦ç”¨çŠ¶æ€
- âœ… Framer Motion åŠ¨ç”»æ•ˆæœ

**`web/lib/subject-detector.ts`** - å­¦ç§‘è‡ªåŠ¨æ£€æµ‹
- âœ… `detectSubjectFromText()` - ä»å•æ®µæ–‡æœ¬æ£€æµ‹å­¦ç§‘
- âœ… `detectSubjectFromConversations()` - ä»å¯¹è¯å†å²æ£€æµ‹å­¦ç§‘
- âœ… `detectSubjectIncremental()` - å¢é‡æ£€æµ‹ï¼ˆè€ƒè™‘å¯¹è¯è½®æ¬¡ï¼‰
- âœ… è¿”å›ç½®ä¿¡åº¦å’ŒåŒ¹é…çš„å…³é”®è¯

---

### 3. å®æ—¶çŸ¥è¯†æå–

#### åˆ›å»ºçš„æ–‡ä»¶

**`web/lib/knowledge-extractor.ts`** - çŸ¥è¯†ç‚¹æå–æ¨¡å—
- âœ… ä» AI å“åº”ä¸­æå–çŸ¥è¯†ç‚¹
- âœ… æ”¯æŒå¤šç§ç±»å‹ï¼šconceptï¼ˆæ¦‚å¿µï¼‰ã€figureï¼ˆäººç‰©ï¼‰ã€eventï¼ˆäº‹ä»¶ï¼‰ã€formulaï¼ˆå…¬å¼ï¼‰ã€placeï¼ˆåœ°ç‚¹ï¼‰ã€periodï¼ˆæ—¶æœŸï¼‰
- âœ… åˆ©ç”¨ç°æœ‰çš„ `history-enhancer.ts` æ£€æµ‹å†å²å…³é”®è¯
- âœ… ç½®ä¿¡åº¦è¯„åˆ†å’Œå»é‡åŠŸèƒ½
- âœ… `extractKnowledgePointsFromConversations()` - æ‰¹é‡æå–
- âœ… `filterKnowledgePoints()` - æŒ‰ç±»å‹å’Œç½®ä¿¡åº¦è¿‡æ»¤

---

### 4. å®‰å…¨åŠ å›º

#### åˆ›å»ºçš„æ–‡ä»¶

**`web/app/api/generate-cards/route.ts`** - çŸ¥è¯†å¡ç‰‡ç”Ÿæˆ API
- âœ… æœåŠ¡ç«¯ä»£ç†ï¼Œé¿å…å‰ç«¯æš´éœ² API Key
- âœ… ä»ç¯å¢ƒå˜é‡è¯»å– `STEPFUN_API_KEY`
- âœ… è°ƒç”¨ StepFun API ç”ŸæˆçŸ¥è¯†å¡ç‰‡
- âœ… JSON è§£æå’ŒéªŒè¯
- âœ… é”™è¯¯å¤„ç†å’Œå‹å¥½æç¤º
- âœ… æ”¯æŒ CORSï¼ˆOPTIONS è¯·æ±‚ï¼‰

**æ ¸å¿ƒå®‰å…¨æ”¹è¿›**:
```typescript
// âŒ æ—§ä»£ç ï¼ˆå‰ç«¯ç›´æ¥è°ƒç”¨ APIï¼‰
const response = await fetch('https://api.stepfun.com/v1/chat/completions', {
  headers: { 'Authorization': `Bearer ${apiKey}` }, // API Key æš´éœ²
});

// âœ… æ–°ä»£ç ï¼ˆé€šè¿‡æœ¬åœ° APIï¼‰
const response = await fetch('/api/generate-cards', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ conversations, subject }),
});
```

---

### 5. ä¸»é¡µé¢åŠ¨æ€åŒ–

#### æ›´æ–°çš„æ–‡ä»¶

**`web/app/page.tsx`** - ä¸»é¡µé¢é‡æ„

**æ ¸å¿ƒæ”¹åŠ¨**:

1. **ç§»é™¤ç¡¬ç¼–ç ** âœ…
   - åˆ é™¤ç¡¬ç¼–ç çš„çŸ¥è¯†å¡ç‰‡ï¼ˆç»†èƒç»“æ„ã€å…‰åˆä½œç”¨ç­‰ï¼‰
   - åˆå§‹çŠ¶æ€ä¸ºç©ºæ•°ç»„ï¼š`useState<KnowledgeCard[]>([])`

2. **æ·»åŠ å­¦ç§‘çŠ¶æ€** âœ…
   ```typescript
   const [currentSubject, setCurrentSubject] = useState<SubjectConfig>(DEFAULT_SUBJECT);
   const [currentPersona, setCurrentPersona] = useState<PersonaType>(DEFAULT_PERSONA.id);
   ```

3. **è‡ªåŠ¨æ£€æµ‹å­¦ç§‘** âœ…
   ```typescript
   useEffect(() => {
     if (messages.length >= 2) {
       const detected = detectSubjectFromConversations(conversations);
       if (detected.confidence > 0.3) {
         setCurrentSubject(detected.subject);
       }
     }
   }, [messages]);
   ```

4. **è‡ªåŠ¨ç”ŸæˆçŸ¥è¯†å¡ç‰‡** âœ…
   - æ¯ 3 è½®å¯¹è¯è‡ªåŠ¨è§¦å‘
   - æˆ–æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®ç”Ÿæˆ
   - æ˜¾ç¤ºç”ŸæˆçŠ¶æ€å’ŒåŠ è½½åŠ¨ç”»

5. **ç©ºçŠ¶æ€å¤„ç†** âœ…
   - æ˜¾ç¤ºå‹å¥½çš„ç©ºçŠ¶æ€æç¤º
   - æä¾›æ‰‹åŠ¨ç”ŸæˆæŒ‰é’®
   - ç”Ÿæˆä¸­æ˜¾ç¤ºåŠ è½½åŠ¨ç”»

6. **ä½¿ç”¨é…ç½®æ–‡ä»¶** âœ…
   - Header ä¸­æ·»åŠ å­¦ç§‘é€‰æ‹©å™¨
   - äººè®¾é€‰æ‹©å™¨ä»é…ç½®åŠ¨æ€æ¸²æŸ“
   - è®¾ç½®é¢æ¿ä½¿ç”¨æ¨¡å‹é…ç½®

---

## ğŸ“Š ä»£ç è´¨é‡

### ç¼–è¯‘çŠ¶æ€
âœ… **ç¼–è¯‘æˆåŠŸ** - TypeScript æ— é”™è¯¯ï¼ŒNext.js æ„å»ºé€šè¿‡

### ä»£ç å¤ç”¨æ€§
- âœ… æ‰€æœ‰é…ç½®é›†ä¸­ç®¡ç†
- âœ… ç»„ä»¶å¯å¤ç”¨ï¼ˆSubjectSelectorï¼‰
- âœ… å·¥å…·å‡½æ•°å¯å¤ç”¨ï¼ˆdetectSubject, extractKnowledgePointsï¼‰

### å¯ç»´æŠ¤æ€§
- âœ… ç±»å‹å®šä¹‰å®Œæ•´
- âœ… æ³¨é‡Šæ¸…æ™°
- âœ… èŒè´£åˆ†ç¦»æ˜ç¡®

---

## ğŸ¯ å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

### 1. å­¦ç§‘åŠ¨æ€åˆ‡æ¢
- âœ… 7 ä¸ªå­¦ç§‘å¯é€‰
- âœ… æ ¹æ®å¯¹è¯å†…å®¹è‡ªåŠ¨æ£€æµ‹
- âœ… å­¦ç§‘åˆ‡æ¢åçŸ¥è¯†å¡ç‰‡é‡æ–°ç”Ÿæˆ

### 2. çŸ¥è¯†å¡ç‰‡åŠ¨æ€ç”Ÿæˆ
- âœ… åˆå§‹ä¸ºç©ºï¼ˆæ— ç¡¬ç¼–ç ï¼‰
- âœ… æ¯ 3 è½®å¯¹è¯è‡ªåŠ¨ç”Ÿæˆ
- âœ… æ”¯æŒæ‰‹åŠ¨ç”Ÿæˆ
- âœ… ç”ŸæˆçŠ¶æ€å¯è§†åŒ–

### 3. å®‰å…¨æ€§æå‡
- âœ… API Key ä¸æš´éœ²åœ¨å‰ç«¯
- âœ… é€šè¿‡ Next.js API Route ä»£ç†

### 4. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- âœ… ç©ºçŠ¶æ€å‹å¥½æç¤º
- âœ… åŠ è½½çŠ¶æ€åŠ¨ç”»
- âœ… å­¦ç§‘è‡ªåŠ¨æ£€æµ‹
- âœ… å›¾æ ‡å’Œé¢œè‰²åŒºåˆ†

---

## ğŸ“ æ–°å¢æ–‡ä»¶æ¸…å•

```
web/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ subjects.ts           # å­¦ç§‘é…ç½®ï¼ˆ7ä¸ªå­¦ç§‘ï¼‰
â”‚   â””â”€â”€ models.ts             # æ¨¡å‹å’ŒéŸ³è‰²é…ç½®
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ subject-detector.ts   # å­¦ç§‘è‡ªåŠ¨æ£€æµ‹
â”‚   â”œâ”€â”€ knowledge-extractor.ts # å®æ—¶çŸ¥è¯†æå–
â”‚   â””â”€â”€ prompts/
â”‚       â””â”€â”€ personas.ts       # æ›´æ–°ï¼šæ·»åŠ å¯¼å‡º
â”œâ”€â”€ components/
â”‚   â””â”€â”€ SubjectSelector.tsx   # å­¦ç§‘é€‰æ‹©å™¨ç»„ä»¶
â””â”€â”€ app/
    â””â”€â”€ api/
        â””â”€â”€ generate-cards/
            â””â”€â”€ route.ts      # çŸ¥è¯†å¡ç‰‡ç”Ÿæˆ API
```

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

```
web/
â””â”€â”€ app/
    â””â”€â”€ page.tsx              # ä¸»é¡µé¢é‡æ„ï¼ˆç§»é™¤ç¡¬ç¼–ç ï¼Œé›†æˆåŠ¨æ€åŠŸèƒ½ï¼‰
```

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’ï¼ˆP1 åŠŸèƒ½ï¼‰

### å¾…å®ç°åŠŸèƒ½

1. **çŸ¥è¯†å›¾è°±å¯è§†åŒ–** (React Flow)
   - æ–‡ä»¶ï¼š`web/lib/knowledge-graph.ts`
   - æ–‡ä»¶ï¼š`web/components/KnowledgeGraph.tsx`
   - åŠŸèƒ½ï¼šèŠ‚ç‚¹ã€è¿çº¿ã€å¯è§†åŒ–å±•ç¤º

2. **WebSocket å®æ—¶çŸ¥è¯†æå–é›†æˆ**
   - ä¿®æ”¹ï¼š`web/lib/stepfun-realtime.ts`
   - åŠŸèƒ½ï¼šå®æ—¶å“åº”æ—¶è§¦å‘çŸ¥è¯†æå–

3. **ä»£ç ä¼˜åŒ–**
   - æå–å…±äº«é€»è¾‘åˆ°è‡ªå®šä¹‰ Hooks
   - åˆ é™¤é‡å¤æ–‡ä»¶ï¼ˆknowledge-tutor/page.tsxï¼‰
   - ç»„ä»¶æ‹†åˆ†ï¼ˆChatPanel, KnowledgePanel, SettingsPanelï¼‰

---

## âœ… éªŒæ”¶æ ‡å‡†æ£€æŸ¥

### åŠŸèƒ½æ€§
- [x] æ— ç¡¬ç¼–ç çŸ¥è¯†å¡ç‰‡ï¼ˆåˆå§‹ä¸ºç©ºï¼ŒåŠ¨æ€ç”Ÿæˆï¼‰
- [x] å­¦ç§‘é€‰æ‹©å™¨æ­£å¸¸å·¥ä½œï¼ˆ7ä¸ªå­¦ç§‘ï¼‰
- [x] å¯¹è¯3è½®åè‡ªåŠ¨ç”ŸæˆçŸ¥è¯†å¡ç‰‡
- [x] æ‰€æœ‰å­¦ç§‘é€šç”¨ï¼ˆä¸é™å®šç‰¹å®šå­¦ç§‘ï¼‰

### å®‰å…¨æ€§
- [x] API Key ä¸æš´éœ²åœ¨å‰ç«¯
- [x] çŸ¥è¯†å¡ç‰‡ç”Ÿæˆé€šè¿‡ API Route
- [x] ç¯å¢ƒå˜é‡é…ç½®å‡†å¤‡å°±ç»ª

### ä»£ç è´¨é‡
- [x] TypeScript æ— é”™è¯¯
- [x] ç¼–è¯‘æˆåŠŸ
- [x] ä»£ç å¤ç”¨æ€§æå‡

---

## ğŸ‰ é˜¶æ®µæ€»ç»“

**å®ŒæˆçŠ¶æ€**: âœ… **P0 ä»»åŠ¡å…¨éƒ¨å®Œæˆ**

**æ ¸å¿ƒæˆå°±**:
1. âœ… ç§»é™¤äº†æ‰€æœ‰ç¡¬ç¼–ç å†…å®¹
2. âœ… å®ç°äº† 7 ä¸ªå­¦ç§‘çš„é€šç”¨æ”¯æŒ
3. âœ… å»ºç«‹äº†å®‰å…¨çš„ API æ¶æ„
4. âœ… åˆ›å»ºäº†å¯æ‰©å±•çš„é…ç½®ç³»ç»Ÿ
5. âœ… å®ç°äº†å­¦ç§‘è‡ªåŠ¨æ£€æµ‹å’ŒçŸ¥è¯†å¡ç‰‡åŠ¨æ€ç”Ÿæˆ

**éµå¾ªçš„äº§å“æ–¹æ³•è®º**:
> **è¿½æ±‚æè‡´ç®€å•** - ä¿ç•™æ ¸å¿ƒåŠŸèƒ½ï¼ˆè¯­éŸ³äº¤äº’ï¼‰ï¼Œç§»é™¤ç¡¬ç¼–ç ï¼Œå®ç°åŠ¨æ€è‡ªé€‚åº”

**ç¬¦åˆçš„è®¾è®¡å“²å­¦**:
> **Focused Knowledge** - ä¸“æ³¨ã€å…‹åˆ¶ã€é€šç”¨

---

**å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¯åŠ¨æµ‹è¯•ï¼** ğŸš€

**å¯åŠ¨å‘½ä»¤**:
```bash
cd web
npm run dev
```

**è®¿é—®åœ°å€**: http://localhost:3000

**æµ‹è¯•è¦ç‚¹**:
1. æ£€æŸ¥å­¦ç§‘é€‰æ‹©å™¨æ˜¯å¦æ­£å¸¸æ˜¾ç¤º 7 ä¸ªå­¦ç§‘
2. éªŒè¯åˆ‡æ¢å­¦ç§‘åç•Œé¢æ— é”™è¯¯
3. æµ‹è¯•ç©ºçŠ¶æ€æ˜¯å¦å‹å¥½æç¤º
4. ç¡®è®¤ç¼–è¯‘æ— é”™è¯¯

---

**ä¸‹ä¸€æ­¥**: é…ç½®ç¯å¢ƒå˜é‡ï¼ˆSTEPFUN_API_KEYï¼‰å¹¶æµ‹è¯•çŸ¥è¯†å¡ç‰‡ç”ŸæˆåŠŸèƒ½
