# 阶段0测试计划 - 智能模型调度系统

> **测试日期**: 2026-01-05
> **测试目标**: 验证智能模型调度系统的功能完整性和性能
> **测试环境**: 本地开发环境

---

## 📋 测试准备

### 环境要求
- [x] Node.js 18+ 已安装
- [x] 依赖包已安装（`npm install`）
- [x] StepFun API Key 已配置
- [x] 浏览器：Chrome/Edge（推荐）

### 启动应用
```bash
cd web
npm run dev
```

访问：http://localhost:3000

---

## 🧪 测试用例总览

| 测试组 | 测试用例数 | 优先级 | 预计时间 |
|--------|-----------|--------|----------|
| TC1: 基础功能测试 | 5 | ⭐⭐⭐⭐⭐ | 10分钟 |
| TC2: 自动模式测试 | 8 | ⭐⭐⭐⭐⭐ | 20分钟 |
| TC3: 手动模式测试 | 6 | ⭐⭐⭐⭐ | 15分钟 |
| TC4: 环境因素测试 | 4 | ⭐⭐⭐ | 10分钟 |
| TC5: 数据分析测试 | 3 | ⭐⭐⭐⭐ | 10分钟 |
| TC6: UI交互测试 | 4 | ⭐⭐⭐⭐ | 10分钟 |
| **总计** | **30** | - | **75分钟** |

---

## 📝 详细测试用例

### TC1: 基础功能测试

#### TC1.1: 应用启动和UI渲染

**目标**: 验证应用正常启动，UI组件正确显示

**操作步骤**:
1. 启动应用：`npm run dev`
2. 访问 http://localhost:3000
3. 检查页面元素

**预期结果**:
- ✅ 页面正常加载
- ✅ Header显示：标题 + 两个设置按钮（模型设置 + 系统设置）
- ✅ 中央显示麦克风按钮
- ✅ 状态显示："准备就绪"

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC1.2: 配置API Key

**目标**: 验证API Key配置功能

**操作步骤**:
1. 点击右上角"系统设置"按钮（⚙️）
2. 输入StepFun API Key
3. 点击"完成"

**预期结果**:
- ✅ 设置面板关闭
- ✅ 配置保存（刷新页面后仍然保留）
- ✅ 可以开始对话

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC1.3: 模型设置面板打开/关闭

**目标**: 验证模型设置面板UI交互

**操作步骤**:
1. 点击右上角"模型设置"按钮（🔧左侧）
2. 检查面板内容
3. 点击面板外部或关闭按钮

**预期结果**:
- ✅ 面板正常打开，显示：
  - 当前使用模型
  - 复杂度分数
  - 三种模式选项
  - 省流量模式开关
  - 网络质量显示
- ✅ 点击外部或关闭按钮，面板正常关闭

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC1.4: 语音对话基础功能

**目标**: 验证基础语音对话功能正常

**操作步骤**:
1. 配置API Key
2. 点击麦克风按钮
3. 允许麦克风权限
4. 说："你好"
5. 等待AI响应

**预期结果**:
- ✅ 状态变化：准备就绪 → 连接中 → 空闲
- ✅ 麦克风按钮激活（有动画效果）
- ✅ 检测到说话（状态变为"正在聆听"）
- ✅ AI回复（语音 + 文本显示）

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC1.5: 当前模型信息显示

**目标**: 验证实时显示当前使用的模型

**操作步骤**:
1. 打开模型设置面板
2. 查看显示信息

**预期结果**:
- ✅ 显示"当前使用: step-audio-2-mini"（初始状态）
- ✅ 复杂度分数显示（如果有）
- ✅ 网络延迟显示

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

### TC2: 自动模式测试（核心）

#### TC2.1: 简单问题 → mini模型

**目标**: 验证简单问题自动选择mini模型

**操作步骤**:
1. 确保处于"自动模式"
2. 说："你好"
3. 打开模型设置查看当前模型

**预期结果**:
- ✅ 复杂度分数：< 10
- ✅ 当前使用: **step-audio-2-mini**
- ✅ 控制台日志显示选择原因

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC2.2: 简单事实查询 → mini模型

**目标**: 验证简单事实查询选择mini模型

**操作步骤**:
1. 说："秦始皇是谁？"
2. 查看模型设置面板

**预期结果**:
- ✅ 复杂度分数：10-30
- ✅ 当前使用: **step-audio-2-mini**
- ✅ 原因显示："简单问题"

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC2.3: "为什么"问题 → 根据分数选择

**目标**: 验证"为什么"类问题的模型选择

**操作步骤**:
1. 说："为什么秦朝会灭亡？"
2. 查看模型设置面板

**预期结果**:
- ✅ 复杂度分数：30-50
- ✅ 当前使用: **step-audio-2-mini**（分数<50）
- ✅ 或：**step-audio-2**（如果对话轮次多）
- ✅ 控制台显示分数计算过程

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC2.4: "如果"问题 → step-audio-2

**目标**: 验证复杂推理问题自动升级到step-audio-2

**操作步骤**:
1. 说："如果项羽不乌江自刎，历史会怎样？"
2. 查看模型设置面板

**预期结果**:
- ✅ 复杂度分数：≥ 50
- ✅ 当前使用: **step-audio-2**
- ✅ 原因显示："高复杂度问题" 或 "包含推理分析"
- ✅ 控制台显示：🔄 模型切换

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC2.5: 搜索请求 → step-audio-2

**目标**: 验证需要工具调用的问题自动升级

**操作步骤**:
1. 说："帮我搜索最新的兵马俑考古发现"
2. 查看模型设置面板

**预期结果**:
- ✅ 复杂度分数：≥ 60（包含工具调用+30）
- ✅ 当前使用: **step-audio-2**
- ✅ 原因显示："需要网络搜索" 或 "需要工具调用"

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC2.6: 多轮对话 → 自动升级

**目标**: 验证对话轮次增加时的模型升级

**操作步骤**:
1. 进行多轮对话：
   - 第1轮："唐朝是什么时候建立的？"（→ mini）
   - 第3轮："唐朝有哪些著名的皇帝？"（→ mini）
   - 第6轮："为什么唐朝会衰落？"（→ 可能升级到step-audio-2）
2. 观察每轮的模型选择

**预期结果**:
- ✅ 前几轮使用mini（分数<50）
- ✅ 第6轮可能升级到step-audio-2（对话轮次加分+30）
- ✅ 控制台显示：conversationTurns递增

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC2.7: 长问题 → 分数累加

**目标**: 验证问题长度对分数的影响

**操作步骤**:
1. 说一个很长的复杂问题（50字以上）：
   "请详细分析一下，如果秦始皇没有统一六国，中国历史会朝什么方向发展，政治、经济、文化会有什么不同？"
2. 查看复杂度分数

**预期结果**:
- ✅ 复杂度分数较高（长度+关键词+推理）
- ✅ 当前使用: **step-audio-2**
- ✅ 分数组成部分：长度20 + "如果"30 + 推理30 = 80+

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC2.8: 控制台日志验证

**目标**: 验证详细的日志输出

**操作步骤**:
1. 打开浏览器开发者工具（F12）
2. 切换到Console标签
3. 进行任意对话
4. 观察日志输出

**预期结果**:
```
✅ Connecting to proxy: ws://localhost:3000/api/ws-proxy?apiKey=***
✅ Model (via URL): step-audio-2-mini  (或 step-audio-2)
✅ Using voice: qingchunshaonv
✅ WebSocket connected to proxy
✅ Session update sent
✅ 选择 step-audio-2-mini: 简单问题 (分数: 15)
✅ Conversation started
✅ Response done
✅ 📊 使用记录已保存: { 模型: 'step-audio-2-mini', 响应时间: '1200ms', 复杂度分数: 15 }
```

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

### TC3: 手动模式测试

#### TC3.1: 切换到高质量模式

**目标**: 验证手动切换到高质量模式

**操作步骤**:
1. 打开模型设置面板
2. 选择"高质量模式"
3. 关闭面板
4. 说任意问题（如"你好"）

**预期结果**:
- ✅ 面板显示选择状态（紫色高亮）
- ✅ 当前使用: **step-audio-2**（无论问题简单与否）
- ✅ 简单问题也使用step-audio-2

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC3.2: 切换到快速模式

**目标**: 验证手动切换到快速模式

**操作步骤**:
1. 打开模型设置面板
2. 选择"快速模式"
3. 关闭面板
4. 说复杂问题（如"如果项羽不..."）

**预期结果**:
- ✅ 面板显示选择状态（蓝色高亮）
- ✅ 当前使用: **step-audio-2-mini**（无论问题复杂）
- ✅ 复杂问题也使用mini

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC3.3: 切换回自动模式

**目标**: 验证从手动模式切换回自动模式

**操作步骤**:
1. 当前在"高质量模式"或"快速模式"
2. 打开模型设置面板
3. 选择"自动选择（推荐）"
4. 关闭面板
5. 说简单问题和复杂问题

**预期结果**:
- ✅ 面板显示选择状态（青色高亮）
- ✅ 简单问题 → mini
- ✅ 复杂问题 → step-audio-2
- ✅ 智能调度恢复工作

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC3.4: 模式切换持久化

**目标**: 验证模式选择在页面刷新后保持

**操作步骤**:
1. 选择"高质量模式"
2. 刷新页面（F5）
3. 打开模型设置面板

**预期结果**:
- ✅ 模式选择保持为"高质量模式"
- ⚠️ 注意：如果未实现持久化，这是可接受的Bug

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC3.5: 高质量模式下工具调用

**目标**: 验证手动模式下工具调用仍正常

**操作步骤**:
1. 切换到"高质量模式"
2. 说："帮我搜索兵马俑的最新发现"

**预期结果**:
- ✅ 使用step-audio-2
- ✅ 能够调用搜索工具（如果API支持）

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC3.6: 快速模式下多轮对话

**目标**: 验证快速模式下对话质量

**操作步骤**:
1. 切换到"快速模式"
2. 进行5轮简单对话
3. 进行1轮复杂对话

**预期结果**:
- ✅ 所有对话都使用step-audio-2-mini
- ✅ 响应速度快
- ✅ 对话质量可接受

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

### TC4: 环境因素测试

#### TC4.1: 省流量模式

**目标**: 验证省流量模式的影响

**操作步骤**:
1. 打开模型设置面板
2. 开启"省流量模式"开关
3. 在"自动模式"下说复杂问题

**预期结果**:
- ✅ 复杂度分数降低（省流量惩罚-40）
- ✅ 复杂问题也可能使用mini
- ✅ 原因显示："省流量模式"

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC4.2: 网络延迟检测

**目标**: 验证网络延迟测量功能

**操作步骤**:
1. 打开模型设置面板
2. 查看"网络质量检测"显示
3. 等待几秒，刷新查看

**预期结果**:
- ✅ 显示网络延迟（如"1.2s ✅ 良好"）
- ✅ 延迟 <1s：绿色"良好"
- ✅ 延迟 1-2s：黄色"一般"
- ✅ 延迟 >2s：红色"较慢"

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC4.3: 设备性能检测

**目标**: 验证设备性能自动检测（通过控制台）

**操作步骤**:
1. 打开开发者工具Console
2. 刷新页面
3. 查看初始化日志

**预期结果**:
- ✅ 控制台显示设备性能检测结果
- ✅ 桌面端：high/medium
- ✅ 移动端：medium/low

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC4.4: 模拟网络环境（可选）

**目标**: 验证网络差时的降级策略

**操作步骤**:
1. 打开Chrome开发者工具
2. 切换到Network标签
3. 选择"Slow 3G"
4. 在自动模式下说复杂问题

**预期结果**:
- ✅ 网络延迟显示"较慢"
- ✅ 复杂问题可能因网络慢降级到mini
- ⚠️ 需要实际延迟>2s才触发

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败
**备注**: 此测试可选

---

### TC5: 数据分析测试

#### TC5.1: 使用记录自动保存

**目标**: 验证对话数据自动记录

**操作步骤**:
1. 打开开发者工具 → Application → Local Storage
2. 进行3-5轮对话
3. 刷新LocalStorage查看

**预期结果**:
- ✅ 存在键：`aitutor_model_analytics`
- ✅ 包含最近对话记录数组
- ✅ 每条记录包含：
  - timestamp
  - modelUsed
  - complexityScore
  - responseTime
  - networkLatency
  - devicePerformance
  - reason

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC5.2: 数据导出功能

**目标**: 验证数据可以导出（通过控制台）

**操作步骤**:
1. 打开开发者工具Console
2. 输入：
```javascript
const analytics = window.getModelAnalytics ?
  window.getModelAnalytics() :
  require('@/lib/model-analytics').getModelAnalytics();
console.log(analytics.exportToJSON());
```

**预期结果**:
- ✅ 输出JSON格式的使用记录
- ✅ 包含所有历史对话数据

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败
**备注**: 此测试需要开发者知识

---

#### TC5.3: 生成统计报告

**目标**: 验证统计报告生成（通过控制台）

**操作步骤**:
1. 在Console输入：
```javascript
const analytics = require('@/lib/model-analytics').getModelAnalytics();
console.log(analytics.generateReport());
```

**预期结果**:
- ✅ 输出统计数据：
  - totalConversations
  - stepAudio2UsageRate
  - stepAudio2MiniUsageRate
  - averageResponseTime
  - costSavings

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败
**备注**: 此测试需要开发者知识

---

### TC6: UI交互测试

#### TC6.1: 面板打开/关闭动画

**目标**: 验证UI动画效果

**操作步骤**:
1. 点击模型设置按钮
2. 观察面板打开动画
3. 点击关闭按钮
4. 观察面板关闭动画

**预期结果**:
- ✅ 打开：淡入 + 缩放效果（smooth）
- ✅ 关闭：淡出 + 缩放效果
- ✅ 背景模糊效果正常

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC6.2: 模式选择交互

**目标**: 验证模式选择的UI反馈

**操作步骤**:
1. 打开模型设置面板
2. 依次点击三种模式
3. 观察选中状态

**预期结果**:
- ✅ 自动模式：青色高亮（cyan-500/20）
- ✅ 高质量模式：紫色高亮（purple-500/20）
- ✅ 快速模式：蓝色高亮（blue-500/20）
- ✅ 选中时有明显的边框和背景色变化

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC6.3: 省流量开关交互

**目标**: 验证开关按钮交互

**操作步骤**:
1. 打开模型设置面板
2. 点击省流量模式开关
3. 观察开关状态变化

**预期结果**:
- ✅ 未开启：灰色背景，滑块在左侧
- ✅ 开启：青色背景，滑块在右侧
- ✅ 滑动动画流畅

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

#### TC6.4: 响应式布局

**目标**: 验证移动端显示效果

**操作步骤**:
1. 打开Chrome开发者工具
2. 切换到设备模拟（Device Toolbar）
3. 选择iPhone 12 Pro
4. 打开模型设置面板

**预期结果**:
- ✅ 面板宽度适配屏幕
- ✅ 文字大小合适
- ✅ 按钮可点击
- ✅ 无横向滚动条

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

## 🎯 快速测试清单（5分钟）

如果时间有限，优先测试这些核心用例：

### 必测项（3分钟）

- [ ] **TC1.4**: 基础语音对话功能
- [ ] **TC2.1**: 简单问题 → mini
- [ ] **TC2.4**: "如果"问题 → step-audio-2
- [ ] **TC3.1**: 手动切换到高质量模式

### 重要项（2分钟）

- [ ] **TC2.2**: 事实查询 → mini
- [ ] **TC2.5**: 搜索请求 → step-audio-2
- [ ] **TC3.2**: 手动切换到快速模式

---

## 📊 测试结果记录

### 通过率统计

| 测试组 | 通过 | 失败 | 通过率 |
|--------|------|------|--------|
| TC1: 基础功能 | _/5 | _/5 | __% |
| TC2: 自动模式 | _/8 | _/8 | __% |
| TC3: 手动模式 | _/6 | _/6 | __% |
| TC4: 环境因素 | _/4 | _/4 | __% |
| TC5: 数据分析 | _/3 | _/3 | __% |
| TC6: UI交互 | _/4 | _/4 | __% |
| **总计** | _/30 | _/30 | __% |

### 发现的问题

| 问题编号 | 优先级 | 问题描述 | 测试用例 |
|---------|--------|---------|---------|
| BUG-001 | ⭐⭐⭐ | | |
| BUG-002 | ⭐⭐ | | |
| BUG-003 | ⭐ | | |

### 改进建议

1. _________________________________
2. _________________________________
3. _________________________________

---

## 🔧 调试指南

### 如果测试失败，检查以下项：

1. **控制台错误**
```javascript
// 打开开发者工具 → Console
// 查看是否有红色错误信息
```

2. **网络请求**
```javascript
// 打开开发者工具 → Network
// 检查WebSocket连接是否成功
// 查看API请求是否正常
```

3. **LocalStorage**
```javascript
// 打开开发者工具 → Application → Local Storage
// 检查配置是否保存
// 检查analytics数据是否记录
```

4. **API Key**
```javascript
// 确保API Key有效
// 确保账户有足够余额
```

---

## ✅ 测试完成标准

- [ ] 核心功能通过率 ≥ 90%
- [ ] 无阻塞性Bug（优先级⭐⭐⭐）
- [ ] 控制台无严重错误
- [ ] 性能可接受（响应时间<3秒）

---

**测试人员**: _____
**测试日期**: _____
**测试环境**: _____
**应用版本**: v0.1.0 (阶段0)
