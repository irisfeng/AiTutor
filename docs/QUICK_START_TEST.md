# 🚀 快速测试指南（5分钟）

> 这个指南帮你快速验证智能调度系统是否正常工作

---

## ⚡ 快速准备（30秒）

```bash
# 1. 启动应用
cd web
npm run dev

# 2. 访问
http://localhost:3000

# 3. 配置API Key
点击右上角设置 → 输入API Key → 完成
```

---

## ✨ 核心测试（5分钟）

### 测试1: 简单问题（1分钟）

**目标**: 验证简单问题使用mini模型

```
1. 点击麦克风按钮
2. 说："你好"
3. 打开模型设置（右上角🔧按钮，在设置按钮左边）
4. 查看"当前使用"
```

✅ **预期**: 显示 `step-audio-2-mini`
❌ **失败**: 显示 `step-audio-2`

---

### 测试2: "如果"问题（2分钟）

**目标**: 验证复杂问题自动升级

```
1. 说："如果项羽不乌江自刎会怎样？"
2. 打开模型设置查看
3. 查看控制台（F12 → Console）
```

✅ **预期**:
- UI显示: `step-audio-2`
- 控制台显示: `🔄 模型切换: 选择 step-audio-2`

❌ **失败**: 仍然使用mini

---

### 测试3: 手动切换（2分钟）

**目标**: 验证手动模式切换

```
1. 打开模型设置
2. 选择"高质量模式"（紫色）
3. 说："你好"
4. 查看当前使用模型
```

✅ **预期**: 显示 `step-audio-2`（简单问题也用）

```
5. 切换到"快速模式"（蓝色）
6. 说："如果项羽..."
7. 查看当前使用模型
```

✅ **预期**: 显示 `step-audio-2-mini`（复杂问题也用）

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

---

### 测试4: WebSocket连接恢复（新功能）⭐

**目标**: 验证WebSocket自动重连功能

**步骤**:
```
1. 开始对话
2. 说一个简单问题（如"你好"）
3. 等待2-3分钟不说话（让连接可能超时）
4. 再次点击麦克风，说"你好"
5. 观察是否自动恢复
```

**预期结果**:
- ✅ 如果连接断开，控制台显示："🔄 Attempting to reconnect..."
- ✅ 连接自动恢复（无需刷新页面）
- ✅ 无需重新填API Key
- ✅ 如果重连失败，显示友好错误提示（红色卡片）
- ✅ 错误提示5秒后自动消失

**实际结果**: _____
**状态**: ☐ 通过 ☐ 失败

**注意**:
- 此测试需要等待连接超时（可能需要2-3分钟）
- 如果网络稳定，可能不会触发重连
- 可以通过关闭网络模拟连接失败

---

## 📊 检查控制台日志

**打开方式**: F12 → Console 标签

### 正常的日志应该长这样：

```
✅ Connecting to proxy: ws://localhost:3000/api/ws-proxy?apiKey=***
✅ Model (via URL): step-audio-2-mini
✅ Using voice: qingchunshaonv
✅ WebSocket connected to proxy
✅ Session update sent
✅ 选择 step-audio-2-mini: 简单问题 (分数: 15)
✅ Conversation started
📥 Received event: response.audio_transcript.delta
✅ Response done
✅ 📊 使用记录已保存: {模型: 'step-audio-2-mini', 响应时间: '1200ms', 复杂度分数: 15}
```

---

## 🎯 快速评分表

| 测试项 | 通过 | 备注 |
|--------|------|------|
| 简单问题 → mini | ☐ | |
| "如果"问题 → step-audio-2 | ☐ | |
| 高质量模式切换 | ☐ | |
| 快速模式切换 | ☐ | |
| WebSocket连接恢复 | ☐ | 新功能 |
| 控制台日志正常 | ☐ | |

**通过率**: ___/6 = ___%

---

## ⚠️ 重要：测试完成前不要提交PR

**PR策略**:
- ❌ **不要**在测试完成前主动提交PR到GitHub
- ✅ **应该**先本地完整测试所有功能
- ✅ **应该**确认核心功能通过率 ≥ 80%
- ✅ **应该**测试WebSocket重连功能
- ✅ **应该**记录所有发现的问题
- ✅ 测试通过后再考虑发布

**当前状态**:
- 本地有1个未推送的commit
- Commit: `78f36fc` - WebSocket重连功能
- ⚠️ **等待测试验证后再推送**

**测试检查清单**:
- [ ] 基础语音对话正常
- [ ] 智能模型切换正常
- [ ] 手动模式切换正常
- [ ] WebSocket自动重连正常
- [ ] 错误提示友好（无alert）
- [ ] 控制台无严重错误
- [ ] 构建成功（npm run build）

**测试通过后再执行**:
```bash
git push aitutor main
# 然后考虑是否需要PR
```

---

## 🐛 常见问题

### Q1: 模型总是mini，不切换？

**可能原因**:
- 复杂度分数不够50分
- 对话轮次太少

**解决方法**:
```
1. 先进行3-4轮简单对话增加轮次
2. 再问复杂问题："如果秦始皇没有统一六国，从政治、经济、文化三个角度分析中国会有什么不同？"
```

---

### Q2: 控制台显示错误？

**常见错误**:

**错误1**: `WebSocket connection failed`
```
解决:
- 检查是否运行 npm run dev
- 检查API Key是否正确
```

**错误2**: `Failed to fetch`
```
解决:
- 检查网络连接
- 检查API Key余额
```

---

### Q3: UI显示不正常？

**检查**:
1. 刷新页面（F5）
2. 清除缓存：Ctrl+Shift+R
3. 检查浏览器：推荐Chrome/Edge

---

## 📱 移动端测试（可选）

```
1. 获取局域网IP:
   macOS: 系统设置 → 网络 → 查看IP
   Windows: ipconfig

2. 手机访问:
   http://[你的IP]:3000

3. 测试流程相同
```

---

## ✅ 测试完成后的检查清单

- [ ] 简单问题使用mini ✅
- [ ] 复杂问题使用step-audio-2 ✅
- [ ] 手动切换模式正常 ✅
- [ ] 控制台无错误 ✅
- [ ] UI显示正常 ✅

**全部通过？** 🎉 恭喜！阶段0功能正常！

**有问题？** 查看 `STAGE0_TEST_PLAN.md` 详细测试计划

---

## 💡 小贴士

**提高复杂度分数的方法**:
1. 问题要长（>30字）
2. 包含"如果"（+30分）
3. 多轮对话后（每轮+5分）
4. 包含"搜索"（+30分）

**示例高复杂度问题**:
```
"如果秦始皇没有统一六国，中国历史会怎样？
请帮我搜索最新的历史研究，从政治、经济、文化三个角度分析，
并说明对后续朝代的影响。"
→ 分数: 20(长度) + 30(如果) + 20(分析) + 30(搜索) + 30(多工具) = 130分
```

---

**测试时间**: 约5分钟
**测试难度**: ⭐⭐ (简单)
**完成标准**: 至少通过3/5核心测试

🎯 **加油！**
